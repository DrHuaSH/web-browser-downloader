<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webæµè§ˆå™¨ä¸‹è½½å™¨ v4.0 - æµ®åŠ¨å·¥å…·æ </title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
            background: #f8f9fa;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background: white;
            padding: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .url-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            outline: none;
        }
        
        .url-input:focus {
            border-color: #007acc;
        }
        
        .btn {
            background: #007acc;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }
        
        .btn:hover {
            background: #005a9e;
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-secondary:hover {
            background: #545b62;
        }
        
        .status-bar {
            background: #e9ecef;
            padding: 8px 16px;
            font-size: 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            text-align: center;
        }
        
        .welcome-card {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            max-width: 600px;
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .feature-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        
        .feature-icon {
            font-size: 32px;
            margin-bottom: 12px;
        }
        
        .floating-toolbar-demo {
            background: white;
            margin: 20px;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .demo-toolbar {
            position: relative;
            background: linear-gradient(135deg, #007acc, #0056b3);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,123,204,0.3);
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 20px 0;
        }
        
        .demo-toolbar::before {
            content: "ğŸ’¡ è¿™æ˜¯æµ®åŠ¨å·¥å…·æ é¢„è§ˆ";
            position: absolute;
            top: -30px;
            left: 0;
            font-size: 12px;
            color: #6c757d;
        }
        
        .toolbar-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.2s;
        }
        
        .toolbar-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 12px 20px;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            transform: translateX(100%);
            transition: transform 0.3s ease;
            z-index: 10000;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.error {
            background: #dc3545;
        }
        
        .notification.warning {
            background: #ffc107;
            color: #212529;
        }
        
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 16px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 14px;
            margin: 16px 0;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="header">
        <input 
            type="url" 
            class="url-input" 
            id="urlInput"
            placeholder="è¾“å…¥ç½‘å€ (ä¾‹å¦‚: google.com, github.com)"
            list="url-suggestions"
        >
        <datalist id="url-suggestions">
            <option value="https://www.google.com">
            <option value="https://www.github.com">
            <option value="https://www.example.com">
            <option value="https://httpbin.org">
            <option value="https://jsonplaceholder.typicode.com">
            <option value="https://www.baidu.com">
            <option value="https://www.youtube.com">
            <option value="https://www.bilibili.com">
        </datalist>
        <button class="btn" id="goBtn">è®¿é—®å¹¶æ³¨å…¥å·¥å…·æ </button>
        <button class="btn btn-secondary" id="newTabBtn">ä»…æ–°æ ‡ç­¾é¡µ</button>
    </div>
    
    <div class="status-bar">
        <span id="statusText">å°±ç»ª</span>
        <span>v4.0.0 - æµ®åŠ¨å·¥å…·æ æ¨¡å¼</span>
    </div>
    
    <div class="main-content">
        <div class="welcome-card">
            <h1>ğŸ› ï¸ Webæµè§ˆå™¨ä¸‹è½½å™¨ v4.0</h1>
            <p><strong>æµ®åŠ¨å·¥å…·æ æ¨¡å¼</strong> - åœ¨æ–°çª—å£ä¸­æ³¨å…¥ä¸‹è½½å·¥å…·æ </p>
            
            <div class="feature-grid">
                <div class="feature-card">
                    <div class="feature-icon">ğŸ¯</div>
                    <h3>æµ®åŠ¨å·¥å…·æ </h3>
                    <p>åœ¨ç›®æ ‡ç½‘ç«™ä¸Šæ˜¾ç¤ºä¸‹è½½æŒ‰é’®</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">ğŸ”—</div>
                    <h3>æ™ºèƒ½æ£€æµ‹</h3>
                    <p>è‡ªåŠ¨æ£€æµ‹é¡µé¢ä¸­çš„åª’ä½“æ–‡ä»¶</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">ğŸ“¥</div>
                    <h3>ä¸€é”®ä¸‹è½½</h3>
                    <p>ç›´æ¥åœ¨ç›®æ ‡é¡µé¢ä¸‹è½½å†…å®¹</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">ğŸŒ</div>
                    <h3>è·¨ç«™æ”¯æŒ</h3>
                    <p>æ”¯æŒæ‰€æœ‰å…è®¸è„šæœ¬æ³¨å…¥çš„ç½‘ç«™</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="floating-toolbar-demo">
        <h3>ğŸ¯ æµ®åŠ¨å·¥å…·æ é¢„è§ˆ</h3>
        <p>å½“ä½ è®¿é—®ç½‘ç«™æ—¶ï¼Œä¼šåœ¨é¡µé¢ä¸Šæ˜¾ç¤ºè¿™æ ·çš„å·¥å…·æ ï¼š</p>
        
        <div class="demo-toolbar">
            <span>ğŸŒ Webä¸‹è½½å™¨</span>
            <button class="toolbar-btn">ğŸµ éŸ³è§†é¢‘ (3)</button>
            <button class="toolbar-btn">ğŸ“ æ–‡æœ¬</button>
            <button class="toolbar-btn">ğŸ“„ PDF (1)</button>
            <button class="toolbar-btn">âŒ</button>
        </div>
        
        <h4>å·¥ä½œåŸç†ï¼š</h4>
        <ol>
            <li>ç‚¹å‡»"è®¿é—®å¹¶æ³¨å…¥å·¥å…·æ "æŒ‰é’®</li>
            <li>åœ¨æ–°çª—å£æ‰“å¼€ç›®æ ‡ç½‘ç«™</li>
            <li>è‡ªåŠ¨æ³¨å…¥æµ®åŠ¨å·¥å…·æ åˆ°é¡µé¢</li>
            <li>å·¥å…·æ æ£€æµ‹é¡µé¢ä¸­çš„å¯ä¸‹è½½å†…å®¹</li>
            <li>ç‚¹å‡»ç›¸åº”æŒ‰é’®å³å¯ä¸‹è½½</li>
        </ol>
        
        <h4>æ³¨å…¥çš„JavaScriptä»£ç ï¼š</h4>
        <div class="code-block">
// åˆ›å»ºæµ®åŠ¨å·¥å…·æ 
const toolbar = document.createElement('div');
toolbar.innerHTML = `
  &lt;div style="position:fixed;top:20px;right:20px;z-index:99999;"&gt;
    &lt;button onclick="downloadMedia()"&gt;ğŸµ ä¸‹è½½åª’ä½“&lt;/button&gt;
    &lt;button onclick="downloadText()"&gt;ğŸ“ ä¸‹è½½æ–‡æœ¬&lt;/button&gt;
  &lt;/div&gt;
`;
document.body.appendChild(toolbar);
        </div>
    </div>
    
    <div class="notification" id="notification"></div>
    
    <script>
        class FloatingToolbarBrowser {
            constructor() {
                this.urlInput = document.getElementById('urlInput');
                this.goBtn = document.getElementById('goBtn');
                this.newTabBtn = document.getElementById('newTabBtn');
                this.statusText = document.getElementById('statusText');
                this.notification = document.getElementById('notification');
                
                this.init();
            }
            
            init() {
                this.goBtn.addEventListener('click', () => this.handleGoWithToolbar());
                this.newTabBtn.addEventListener('click', () => this.handleNewTab());
                this.urlInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.handleGoWithToolbar();
                    }
                });
                
                this.updateStatus('å°±ç»ª');
            }
            
            handleGoWithToolbar() {
                const url = this.urlInput.value.trim();
                if (!url) {
                    this.showNotification('è¯·è¾“å…¥ç½‘å€', 'error');
                    return;
                }
                
                const finalUrl = this.smartUrlCompletion(url);
                this.openWithToolbar(finalUrl);
            }
            
            handleNewTab() {
                const url = this.urlInput.value.trim();
                if (!url) {
                    this.showNotification('è¯·è¾“å…¥ç½‘å€', 'error');
                    return;
                }
                
                const finalUrl = this.smartUrlCompletion(url);
                window.open(finalUrl, '_blank');
                this.showNotification('å·²åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€', 'success');
            }
            
            openWithToolbar(url) {
                try {
                    new URL(url);
                    
                    this.updateStatus('æ­£åœ¨æ‰“å¼€å¹¶æ³¨å…¥å·¥å…·æ ...');
                    
                    // æ‰“å¼€æ–°çª—å£
                    const newWindow = window.open(url, '_blank');
                    
                    if (newWindow) {
                        // ç­‰å¾…é¡µé¢åŠ è½½åæ³¨å…¥å·¥å…·æ 
                        setTimeout(() => {
                            this.injectToolbar(newWindow, url);
                        }, 3000);
                        
                        this.showNotification('å·²æ‰“å¼€ç½‘ç«™ï¼Œæ­£åœ¨æ³¨å…¥å·¥å…·æ ...', 'success');
                    } else {
                        this.showNotification('å¼¹çª—è¢«é˜»æ­¢ï¼Œè¯·å…è®¸å¼¹çª—åé‡è¯•', 'warning');
                    }
                    
                    setTimeout(() => {
                        this.updateStatus('å°±ç»ª');
                    }, 3000);
                    
                } catch (error) {
                    this.showNotification('æ— æ•ˆçš„ç½‘å€æ ¼å¼', 'error');
                    this.updateStatus('å°±ç»ª');
                }
            }
            
            injectToolbar(targetWindow, url) {
                try {
                    // æ£€æŸ¥æ˜¯å¦å¯ä»¥è®¿é—®ç›®æ ‡çª—å£
                    if (!targetWindow || targetWindow.closed) {
                        this.showNotification('ç›®æ ‡çª—å£å·²å…³é—­', 'error');
                        return;
                    }
                    
                    // ç”±äºåŒæºç­–ç•¥é™åˆ¶ï¼Œæˆ‘ä»¬æ— æ³•ç›´æ¥æ³¨å…¥åˆ°è·¨åŸŸé¡µé¢
                    // è¿™é‡Œæä¾›ä¸€ä¸ªä¹¦ç­¾å·¥å…·çš„æ–¹æ¡ˆ
                    this.showBookmarkletInstructions(url);
                    
                } catch (error) {
                    console.error('æ³¨å…¥å¤±è´¥:', error);
                    this.showBookmarkletInstructions(url);
                }
            }
            
            showBookmarkletInstructions(url) {
                // åˆ›å»ºä¹¦ç­¾å·¥å…·è¯´æ˜
                const bookmarklet = this.generateBookmarklet();
                
                const instructionWindow = window.open('', '_blank', 'width=600,height=400');
                instructionWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>æµ®åŠ¨å·¥å…·æ ä½¿ç”¨è¯´æ˜</title>
                        <style>
                            body { font-family: Arial, sans-serif; padding: 20px; line-height: 1.6; }
                            .bookmarklet { background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0; }
                            .bookmarklet a { color: #007acc; text-decoration: none; font-weight: bold; }
                            .step { background: #e3f2fd; padding: 10px; margin: 10px 0; border-radius: 6px; }
                        </style>
                    </head>
                    <body>
                        <h2>ğŸ› ï¸ æµ®åŠ¨å·¥å…·æ ä½¿ç”¨è¯´æ˜</h2>
                        <p>ç”±äºæµè§ˆå™¨å®‰å…¨é™åˆ¶ï¼Œæ— æ³•ç›´æ¥æ³¨å…¥å·¥å…·æ ã€‚è¯·ä½¿ç”¨ä»¥ä¸‹ä¹¦ç­¾å·¥å…·ï¼š</p>
                        
                        <div class="step">
                            <strong>æ­¥éª¤1:</strong> å°†ä¸‹é¢çš„é“¾æ¥æ‹–æ‹½åˆ°æµè§ˆå™¨ä¹¦ç­¾æ 
                        </div>
                        
                        <div class="bookmarklet">
                            <a href="${bookmarklet}">ğŸ“¥ Webä¸‹è½½å™¨å·¥å…·æ </a>
                        </div>
                        
                        <div class="step">
                            <strong>æ­¥éª¤2:</strong> åœ¨ä»»ä½•ç½‘é¡µä¸Šç‚¹å‡»è¿™ä¸ªä¹¦ç­¾
                        </div>
                        
                        <div class="step">
                            <strong>æ­¥éª¤3:</strong> å·¥å…·æ ä¼šå‡ºç°åœ¨é¡µé¢å³ä¸Šè§’
                        </div>
                        
                        <p><strong>ç›®æ ‡ç½‘ç«™:</strong> ${url}</p>
                        <p><a href="${url}" target="_blank">ç‚¹å‡»è¿™é‡Œæ‰“å¼€ç›®æ ‡ç½‘ç«™</a></p>
                        
                        <script>
                            setTimeout(() => {
                                if (confirm('æ˜¯å¦ç°åœ¨æ‰“å¼€ç›®æ ‡ç½‘ç«™ï¼Ÿ')) {
                                    window.open('${url}', '_blank');
                                }
                            }, 2000);
                        </script>
                    </body>
                    </html>
                `);
            }
            
            generateBookmarklet() {
                const toolbarCode = `
                (function() {
                    // æ£€æŸ¥æ˜¯å¦å·²ç»å­˜åœ¨å·¥å…·æ 
                    if (document.getElementById('web-downloader-toolbar')) {
                        return;
                    }
                    
                    // åˆ›å»ºå·¥å…·æ æ ·å¼
                    const style = document.createElement('style');
                    style.textContent = \`
                        #web-downloader-toolbar {
                            position: fixed !important;
                            top: 20px !important;
                            right: 20px !important;
                            z-index: 999999 !important;
                            background: linear-gradient(135deg, #007acc, #0056b3) !important;
                            color: white !important;
                            padding: 12px 16px !important;
                            border-radius: 8px !important;
                            box-shadow: 0 4px 12px rgba(0,123,204,0.3) !important;
                            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
                            font-size: 14px !important;
                            display: flex !important;
                            align-items: center !important;
                            gap: 8px !important;
                        }
                        .wd-btn {
                            background: rgba(255,255,255,0.2) !important;
                            color: white !important;
                            border: none !important;
                            padding: 6px 10px !important;
                            border-radius: 4px !important;
                            cursor: pointer !important;
                            font-size: 12px !important;
                            transition: background 0.2s !important;
                        }
                        .wd-btn:hover {
                            background: rgba(255,255,255,0.3) !important;
                        }
                    \`;
                    document.head.appendChild(style);
                    
                    // åˆ›å»ºå·¥å…·æ 
                    const toolbar = document.createElement('div');
                    toolbar.id = 'web-downloader-toolbar';
                    
                    // æ£€æµ‹é¡µé¢å†…å®¹
                    const mediaCount = document.querySelectorAll('video, audio').length;
                    const pdfCount = document.querySelectorAll('a[href$=".pdf"]').length;
                    
                    toolbar.innerHTML = \`
                        <span>ğŸŒ Webä¸‹è½½å™¨</span>
                        <button class="wd-btn" onclick="downloadMedia()">ğŸµ åª’ä½“ (\${mediaCount})</button>
                        <button class="wd-btn" onclick="downloadText()">ğŸ“ æ–‡æœ¬</button>
                        <button class="wd-btn" onclick="downloadPDF()">ğŸ“„ PDF (\${pdfCount})</button>
                        <button class="wd-btn" onclick="closeToolbar()">âŒ</button>
                    \`;
                    
                    document.body.appendChild(toolbar);
                    
                    // ä¸‹è½½åŠŸèƒ½
                    window.downloadMedia = function() {
                        const media = document.querySelectorAll('video, audio');
                        if (media.length === 0) {
                            alert('æœªæ‰¾åˆ°åª’ä½“æ–‡ä»¶');
                            return;
                        }
                        media.forEach((el, i) => {
                            if (el.src) {
                                const a = document.createElement('a');
                                a.href = el.src;
                                a.download = \`media_\${i+1}\`;
                                a.click();
                            }
                        });
                    };
                    
                    window.downloadText = function() {
                        const text = document.body.innerText;
                        const blob = new Blob([text], {type: 'text/plain'});
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = document.title + '.txt';
                        a.click();
                        URL.revokeObjectURL(url);
                    };
                    
                    window.downloadPDF = function() {
                        const pdfs = document.querySelectorAll('a[href$=".pdf"]');
                        if (pdfs.length === 0) {
                            alert('æœªæ‰¾åˆ°PDFæ–‡ä»¶');
                            return;
                        }
                        pdfs.forEach(pdf => {
                            window.open(pdf.href, '_blank');
                        });
                    };
                    
                    window.closeToolbar = function() {
                        const toolbar = document.getElementById('web-downloader-toolbar');
                        if (toolbar) {
                            toolbar.remove();
                        }
                    };
                    
                    // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                    alert('ğŸ‰ Webä¸‹è½½å™¨å·¥å…·æ å·²åŠ è½½ï¼');
                })();
                `;
                
                return 'javascript:' + encodeURIComponent(toolbarCode);
            }
            
            smartUrlCompletion(input) {
                let url = input.trim();
                
                if (url.startsWith('http://') || url.startsWith('https://')) {
                    return url;
                }
                
                if (url.includes('://')) {
                    return url;
                }
                
                if (url.startsWith('localhost') || 
                    url.match(/^\d+\.\d+\.\d+\.\d+/) ||
                    url.startsWith('127.') ||
                    url.startsWith('192.168.') ||
                    url.startsWith('10.')) {
                    return 'http://' + url;
                }
                
                if (!url.includes('.')) {
                    url = 'www.' + url + '.com';
                }
                
                if (!url.startsWith('www.') && 
                    (url.includes('.com') || url.includes('.org') || url.includes('.net') || 
                     url.includes('.edu') || url.includes('.gov') || url.includes('.cn'))) {
                    const parts = url.split('.');
                    if (parts.length === 2) {
                        url = 'www.' + url;
                    }
                }
                
                return 'https://' + url;
            }
            
            updateStatus(status) {
                this.statusText.textContent = status;
            }
            
            showNotification(message, type = 'success') {
                this.notification.textContent = message;
                this.notification.className = \`notification \${type} show\`;
                
                setTimeout(() => {
                    this.notification.classList.remove('show');
                }, 3000);
            }
        }
        
        // åˆå§‹åŒ–
        const browser = new FloatingToolbarBrowser();
    </script>
</body>
</html>